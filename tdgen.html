var authConfig = {
	version: "2.0",
	dailyLimit: true, // Whether to limit each mailbox to submit requests only once a day
	client_id: '70397154074-v67gom3033r5agkucl6kc9fcvm7jbe18.apps.googleusercontent.com', // Google Client ID
	client_secret: 'dnnvZfG-Tnw2pfKo6YJMT9j9', // Google Client Secret
	refresh_token: '', // Refresh token
	domain: "!", //College name to display
	black_list: [""]
};
var gd;

var today;



var html = `
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">	

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta charset="utf-8">
    <title>TeamDrive Generator</title>
    <meta name="robots" content="noindex">
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/9m7KEx1.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/IFen7sx.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://i.imgur.com/9GIrFwq.png">
    <link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/Jacky-lei1/PicGO/images/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Jacky-lei1/PicGO/css/classic-button.css" integrity="sha256-2O3BzKqYcXKGjs+J3+o9xNpfM0E2iKYC69I6oI73Yoc=" crossorigin="anonymous">
	<script src="https://hcaptcha.com/1/api.js" async defer></script>

	<link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
	<style type="text/css">
		#bg, #search-bg {
			background-image: url('https://picsum.photos/2000/1000'); background-position: center center; background-repeat: no-repeat; background-size: cover; background-color: #464646; 
		}
		
		#bg {
		  background-position: center top;
		  padding: 5% 20% 5% 20%;
		}
		
		#search-container {
		  position: relative;
		}
		
		#search-bg {
		  /* Absolutely position it, but stretch it to all four corners, then put it just behind #search's z-index */
		  position: absolute;
		  top: 0px;
		  right: 0px;
		  bottom: 0px;
		  left: 0px;
		  z-index: 99;
		
		  /* Pull the background 70px higher to the same place as #bg's */
		  background-position: center -70px;
		
		  -webkit-filter: blur(10px);
		  filter: url('/media/blur.svg#blur');
		  filter: blur(10px);
		}
		
		#search {
		  /* Put this on top of the blurred layer */
		  position: relative;
		  z-index: 100;
		  padding: 20px;
		  border-radius: 10px;
		  background: rgb(34,34,34); /* for IE */
		  background: rgba(34,34,34,0.6);
		}
		
		@media (max-width: 600px ) {
		  #bg { padding: 5%; }
		  #search-bg { background-position: center -10px; }
		}
		
		@media (max-width: 750px ) {
		  #bg { padding: 10%; }
		  #search-bg { background-position: center -10px; }
		}
		
		#search h2, #search h5, #search h5 a { text-align: center; color: #fefefe; font-weight: normal; }
		#search h2 { margin-bottom: 50px }
		#search h5 { margin-top: 30px; margin-bottom: 50px }
		.card-img-top {
        width: 100%;
        object-fit: cover;
    }
	</style>
		
		<div id="bg">
		  <div id="search-container">
			<div id="search-bg"></div>
			<div id="search">
				<main>
					<div class="container min-height">
		<div>
					<div class="row">
						<div class="col-sm-8 offset-sm-2 col-md-6 offset-md-3 text-center">
							<h1><img src="https://upload.wikimedia.org/wikipedia/commons/1/12/Google_Drive_icon_%282020%29.svg" alt="Google Logo" style="width:50px;height:50px;"></h1>
							<h5><b>Create Google Shared Drives for FREE !</b></h5>
                            <h5><b>Google will make big changes for team drives. Learn more here: <a style="color: white" href="https://www.t.me/msgsuite" target="_blank">https://www.t.me/msgsuite</a></b></h5>

							<div class="info-form text-left">
								<form id="teamDriveForm">
									<div class="form-group">
										<label for="teamDriveName" class="sr-only">
											üí¨ Share Drive Name (can be changed later)
										</label>
										<input type="text" class="form-control" id="teamDriveName" placeholder="üí¨ Shared Drive name" />
									</div>
									<div class="form-group">
										<label for="emailAddress" class="sr-only">
											‚úâÔ∏è Your GMail Address
										</label>
										<input type="email" class="form-control" id="emailAddress" placeholder="‚úâÔ∏è Your Gmail adress" />
									</div>

									<div class="form-group">
										<select id="channel"  type="text" list="chlist">
										   <option value="1" selected>01 - Universidad de Puerto Rico</option>
										   <option value="2">02 - Universidad de Puerto Rico 2</option>
										   <option value="3">03 - Universidad de Puerto Rico 3</option>
										   <option value="4">04 - Instituto La Salle (C√≥rdoba)</option>
										   <option value="5">05 - Flint Hills Technical College</option>
										   <option value="6">06 - Christopher Newport University</option>
										   <option value="7">07 - Ngee Ann Polytechnic</option>
										   <option value="8">08 - The College of St. Scholastica</option>
										   <option value="9">09 - –ü–ì–¢ "–ü—Ä–æ—Ñ.–¥-—Ä –ê—Å–µ–Ω –ó–ª–∞—Ç–∞—Ä–æ–≤"</option>
										   <option value="10">10 - Wadsworth City Schools</option>
										   <option value="11">11 - COLEGIUL TEHNIC \"COSTIN D. NENI»öESCU‚Äù</option>
										   <option value="12">12 - Lindsey Wilson College</option>
										   <option value="13">13 - Springfield Public Schools</option>
										   <option value="14">14 - Hazel Park School District</option>
										   <option value="15">15 - Beaumont Independent School District</option>
										   <option value="16">16 - Southgate Community School District</option>
										   <option value="17">17 - 51 –°—Ä–µ–¥–Ω–æ –£—á–∏–ª–∏—â–µ "–ï–ª–∏—Å–∞–≤–µ—Ç–∞ –ë–∞–≥—Ä—è–Ω–∞"</option>
										   <option value="18">18 - SAIS Dubai</option>
										   <option value="19">19 - Dighton-Rehoboth Regional School District</option>
										   <option value="20">20 - High Tech High</option>
										   <option value="21">21 - Livonia Public Schools</option>
										   <option value="22">22 - Livonia Public Schools 2</option>
										   <option value="23">23 - Maui High School</option>
										   <option value="24">24 - Montgomery Bell Academy</option>
										   <option value="25">25 - Hemet Unified School District</option>
										   <option value="26">26 - Gehlen Catholic School</option>
										   <option value="27">27 - Russell County Public Schools</option>
										   <option value="28">28 - SMASH</option>
										   <option value="29">29 - Maumee City Schools</option>
										   <option value="30">30 - George L Egbert Intermediate School</option>
										   <option value="31">31 - Zane Trace Local School District</option>
										   <option value="32">32 - IPAE</option>
										   <option value="33">33 - Pennsauken Public Schools</option>
										   <option value="34">34 - North Crawford School District</option>
										   <option value="35">35 - Garland ISD</option>
										   <option value="36">36 - Central Square School District</option>
										   <option value="37">37 - Walpole Public Schools</option>
										   <option value="38">38 - SAM INTERNATIONAL SCHOOL</option>
										   <option value="39">39 - COLEGIO SAN AGUSTIN</option>
										   <option value="40">40 - Don Bosco Educational Centers</option>
										   <option value="41">41 - Dinas Pendidikan DKI Jakarta Indonesia</option>
										   <option value="42">42 - Department of Education</option>
										   <option value="43">43 - KVS Delhi Region</option>
										   <option value="44">üöß - Not working </option>
										   <option value="45">45 - DepEd Dasmari√±as</option>
										   <option value="46">46 - Liceul Waldorf Cluj</option>
										   <option value="47">47 - Schools Division Office of Quezon City</option>
										   <option value="48">üöß 48 - Not working</option>
										   <option value="49">üöß 49 - Not working</option>
										   <option value="50">50 - Three H Redwood Academy</option>
										   <option value="51">51 - MICA</option>
										</select>
									</div>
									<div class="form-group">
										<div class="h-captcha" data-sitekey="1b25fe2c-fa04-4ae0-b1b7-61d10597299c"></div>
									</div>
									<div class="form-check" style="visibility:hidden;">
										<input type="checkbox" class="form-check-input" id="customTheme" value="" />
										<label class="form-check-label" for="customTheme">
											<b>Customize the theme of the SharedDrive (you can change it after creation)</b>
										</label>
									</div>
									
									<div id="customThemeSection" class="d-none">
										<div id="teamDriveThemePreview"></div>
										<div id="teamDriveThemeOptions">
											<div class="form-check">
												<input class="form-check-input" type="radio" name="teamDriveTheme" id="teamDriveThemeOptionRandom" value="random" checked />
												<label class="form-check-label" for="teamDriveThemeOptionRandom">
													Random
												</label>
											</div>
										</div>
										
									</div class="col-sm-8 offset-sm-2 col-md-6 offset-md-3">
										<button type="submit" class="btn btn-primary">Create</button></br></br>
										<a class="btn btn-danger" href="https://www.t.me/msgsuite" target="_blank" role="button">Telegram Channel</a> 
										<a class="btn btn-secondary" href="https://www.t.me/msgsuitechat" target="_blank" role="button">Telegram Chat</a> 									
								</form>
							</div>
						</div>
					</div>
				</div>
			

				<div class="modal fade" id="loadMe" tabindex="-1" role="dialog" aria-labelledby="loadMeLabel">
					<div class="modal-dialog modal-sm" role="document">
						<div class="modal-content">
							<div class="modal-body text-center">
								<div class="d-flex justify-content-center">
									<div class="spinner-border" role="status">
										<span class="sr-only">‚öôÔ∏è Creating the Shared Drive<br>Please wait...</span>
									</div>
								</div>
								<div clas="loader-txt">
									<p>‚öôÔ∏è Creating the Shared Drive<br>Please wait...</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
<script>
    var teamDriveThemes;
    $("input[id=customTheme]").change(function() {
        if ($(this).is(":checked")) {
            $("#customThemeSection").removeClass("d-none");
        } else {
            $("#customThemeSection").addClass("d-none");
            $("input[name=teamDriveTheme]")[0].click();
        }
    });
    $.get("/teamDriveThemes", function(json) {
                teamDriveThemes = json.teamDriveThemes;
                $.each(json.teamDriveThemes, function(i, item) {
                            $("#teamDriveThemeOptions").append(\`
        <div class="form-check">
           <input
            class="form-check-input"
            type="radio"
            name="teamDriveTheme"
            id="teamDriveThemeOption-\${item.id}"
            value="\${item.id}"
          />
          <label class="form-check-label" for="teamDriveThemeOption-\${item.id}">
           \${item.id}
          </label>
        </div>
        \`);
      });
      $("input[name=teamDriveTheme]").change(function() {
        var themeId = this.value;
        if (themeId === "random") {
          $("#teamDriveThemePreview").html("");
        } else {
          var theme = teamDriveThemes.find(function(t) {
            return t.id == themeId;
          });
          $("#teamDriveThemePreview").html(
            \`
          <div class="card" style="background-color: \${theme.colorRgb}">
            <img src="\${theme.backgroundImageLink}" class="card-img-top" alt="\${theme.id}" />
            <div class="card-body">
              <h5 class="card-text" style="color: white">
                \${theme.id}
              </h5>
            </div>
          </div>
      \`
          );
        }
      });
      $("#teamDriveForm").on("submit", function(event) {
        event.preventDefault();
        $("#loadMe").modal({
          backdrop: "static", //remove ability to close modal with click
          keyboard: false, //remove option to close with keyboard
          show: true //Display loader!
        });
        $.ajax({
          type: "POST",
          url: "/drive",
          data: JSON.stringify({
            teamDriveName: $("input[id=teamDriveName]").val(),
            teamDriveThemeId: $("input[name=teamDriveTheme]:checked").val(),
            emailAddress: $("input[id=emailAddress]").val(),
			channel: $("select[id=channel]").val(),
			recaptcha: hcaptcha.getResponse()
          }),
          success: function(data) {
            $("#loadMe").modal("hide");
            alert("‚úÖ Your Shared Drive has successfully been created !");
          },
          error: function(request, status, error) {
            $("#loadMe").modal("hide");
            alert("‚ö†Ô∏è Ouuups, we got an error : " + request.responseText + "<br>Please let us know the error message here : t.me/msgsuitechat");
          },
          contentType: "application/json"
        });
      });
    });
</script>
</html>
`;

addEventListener("fetch", event => {
	event.respondWith(handleRequest(event.request));
});

var dailyLimit = [];

/**
 * Fetch and log a request
 * @param {Request} request
 */
async function handleRequest(request) {
	if (authConfig.dailyLimit) {
		if (!today) today = new Date().getDate();

		// Remove email rate limit every day
		if (new Date().getDate() != today) {
			today = new Date().getDate();
			dailyLimit.length = 0;
		}
	}
  
	if (gd == undefined) {
		gd = new googleDrive(authConfig);
	}
	let url = new URL(request.url);
	let path = url.pathname;

	switch (path) {
		case "/teamDriveThemes":
			let teamDriveThemes = await gd.getTeamDriveThemes();
			return new Response(JSON.stringify(teamDriveThemes), {
				status: 200,
				headers: {
					"Content-Type": "application/json",
					"Access-Control-Allow-Origin": "*"
				}
			});
		case "/drive":
			if (request.method === "POST") {

				const requestBody = await request.json();
				//È™åËØÅÁ†Å
				if(requestBody.recaptcha.length==0){
					return new Response('Complete the captcha please', {
						status: 400
					});
				}
				//Âõ¢ÁõòÂ§öÈÄâ
				if(requestBody.channel==1){
					console.log(234)
					authConfig.refresh_token = '1//04kyCH_H7lEdaCgYIARAAGAQSNwF-L9IrwQSv1BM2isqmveMCHsoAP1hYNdar14aN9IHAIaSnSqlCZnTAwF7pGqGfdw6iwmIDv3U';
					authConfig.domain = "Universidad de Puerto Rico";   
				}
				if(requestBody.channel==2){
					console.log(234)
					authConfig.client_id = '65007582948-etotiv4att4i1nagi0d432237gbr06h1.apps.googleusercontent.com';
					authConfig.client_secret = 's1La0RHgxjvzw9rti4jLvLR9';
					authConfig.refresh_token = '1//04gqibbB5fivFCgYIARAAGAQSNwF-L9IrHrDF1AgnnWigs_sMH3DXK66opycnLWxyzIHq5-W16c1taSm7Hb3Ry6wAuLPP8bHL7uE';
					authConfig.domain = "Universidad de Puerto Rico 2";   
				}
				if(requestBody.channel==3){
					console.log(234)
					authConfig.client_id = '594163739909-n4tmphe3ugfk5monvndqn27da7j788nd.apps.googleusercontent.com';
					authConfig.client_secret = 'Lc-sLO7ECQgFF1n1wSPIgm6S';
					authConfig.refresh_token = '1//04OombrKLgQZKCgYIARAAGAQSNwF-L9IrSRpAlSXQaZtPkFoqV7YxgMH-w5WvMV850y7D-SUmXeTcRkSdGmdkU_f2nGL7O7bepVk';
					authConfig.domain = "Universidad de Puerto Rico 3";   
				}
				if(requestBody.channel==4){
					console.log(234)
					authConfig.client_id = '952997919407-vftrc9etkia17nsv1pkst9474ueqsf2h.apps.googleusercontent.com';
					authConfig.client_secret = 'vzYpbHEl75PsCuAVwJVIdLBs';
					authConfig.refresh_token = '1//04M6EAZELxcwBCgYIARAAGAQSNwF-L9IrV_jlX-Q9ciR4G_tha6L_evffFuCAbhcKZiHzTkcmpDyzj403sEmAMPjzP2WgKpVS8uM';
					authConfig.domain = "Instituto La Salle (C√≥rdoba)";   
					  
				}
				if(requestBody.channel==5){
					console.log(234)
					authConfig.client_id = '1046623546400-h75gkvvm3ginbvh4vviaru2mgmrdnp03.apps.googleusercontent.com';
					authConfig.client_secret = '31l9uaib6RH_Fa5K54QvGfjg';
					authConfig.refresh_token = '1//04zljMQWHZHUwCgYIARAAGAQSNwF-L9IrA9mCxWdqMn1swo_tRTUyTCDXeavFmCfm158AebNTqf_MwH0SUbUJzfnfAJSBqWRDarg';
					authConfig.domain = "Flint Hills Technical College"; 
				}
				if(requestBody.channel==6){
					console.log(234)
					authConfig.client_id = '528397722624-oo939a46e60r7rq201b4vt3n6jveeocq.apps.googleusercontent.com';
					authConfig.client_secret = '8RQn_OE3KKsPMQoIF1pBGz6E';
					authConfig.refresh_token = '1//04OqeD7OqM7AdCgYIARAAGAQSNwF-L9IrzpH2aNFOWEUw5JrS3uSW21H8mF5VCA7o_1JDCMmDoKUPKG2FQ6xL3ZsLFnEAYgo3j1c';
					authConfig.domain = "Christopher Newport University";   
				}
				if(requestBody.channel==7){
					console.log(234)
					authConfig.client_id = '1051567007020-d2clb1ba11ch93kcn2oq1q6nd8602b78.apps.googleusercontent.com';
					authConfig.client_secret = 'XjcgVlBWH27RXJ5hDLuHgtNY';
					authConfig.refresh_token = '1//0441VPLdjgKMMCgYIARAAGAQSNwF-L9Ire4S13eVX7lAQO518_P6z84a8s9P1s9ajZ7yzvaHMj0Ln_kMg7b4VSh243dxtEV3mUDs';
					authConfig.domain = "Ngee Ann Polytechnic";   
				}
				if(requestBody.channel==8){
					console.log(234)
					authConfig.client_id = '929090850958-8r0k8rp5p4q3b49ad880qo4kjdqdh8oe.apps.googleusercontent.com';
					authConfig.client_secret = 'WWmzBC17OCFAEs5ZsaydUsxy';
					authConfig.refresh_token = '1//04corlYvf-LDcCgYIARAAGAQSNwF-L9Ir6FlCYep2lKaPCa_F6n8fZw3WJPe4L4Ge60DtlX-Q1k6aWIlLx9os7l6BsdfoHdICRBg';
					authConfig.domain = "The College of St. Scholastica";   
				}
				if(requestBody.channel==9){
					console.log(234)
					authConfig.client_id = '996269337403-j9281ta373bt5mtg3e5s7a401fl02rme.apps.googleusercontent.com';
					authConfig.client_secret = 'nul7dJHZjcXRvxg-yCeMBpus';
					authConfig.refresh_token = '1//04W0kFgxOqtWtCgYIARAAGAQSNwF-L9Ir2rRHDz2vDE-kbxzM1z4dkAdvao6j5QzKhxie6K6PmsLxSfEESFBg-A1BOu5mbInvUX0';
					authConfig.domain = "–ü–ì–¢ –ü—Ä–æ—Ñ.–¥-—Ä –ê—Å–µ–Ω –ó–ª–∞—Ç–∞—Ä–æ–≤";   
				}
				if(requestBody.channel==10){
					console.log(234)
					authConfig.client_id = '85843169573-ul790kn1hqkai1233g0r8kehfer7v70l.apps.googleusercontent.com';
					authConfig.client_secret = 'tRM0NAZP3ZGBZSoEW3CWY2YZ';
					authConfig.refresh_token = '1//04qHCeKpvr8FtCgYIARAAGAQSNwF-L9IrIHb5TjC1imwUDRbt2GbqPk9PE-knTDlVPQ6sU7mp-cukqaFG5v5OlxA8Ns0mcH5AcaM';
					authConfig.domain = "Wadsworth City Schools";   
				}
				if(requestBody.channel==11){
					console.log(234)
					authConfig.client_id = '272505510281-4khuhf1gnb747js0sfjdmnd910o6cbf5.apps.googleusercontent.com';
					authConfig.client_secret = 'gPnHD_tePsVwEJQQpgfMb157';
					authConfig.refresh_token = '1//04N9EujnLF3QACgYIARAAGAQSNwF-L9IrltatftSXsYZ-ENoxyVXTH-9G1mKPCK-RYk_El-Ldvyd1szaB5NWCv_MD8oqw3Q0ESp4';
					authConfig.domain = "COLEGIUL TEHNIC COSTIN D. NENI»öESCU";   
				}
				if(requestBody.channel==12){
					console.log(234)
					authConfig.client_id = '940350338024-6td0smti5bs7esa8vdrsfekk8bhvaeul.apps.googleusercontent.com';
					authConfig.client_secret = 'AG-bSU1r12ubGoKE5YL9VxVX';
					authConfig.refresh_token = '1//04IQshuJFjz58CgYIARAAGAQSNwF-L9Ir7Jiuoyk2kQ-8Gki2qTGzICT1x1La0V48PVH9hVmb1Zs-i8Dzq9tu96CpXDd7yUUu1vM';
					authConfig.domain = "Lindsey Wilson College";   
				}
				if(requestBody.channel==13){
					console.log(234)
					authConfig.client_id = '1038984251162-ss3gvhepulut579mr1i3qc25dt243f37.apps.googleusercontent.com';
					authConfig.client_secret = '0ktdpJtMxatIHHDSqRqZ00Av';
					authConfig.refresh_token = '1//04dFt34joZxJ-CgYIARAAGAQSNwF-L9IrfMi1q1b95HpefpDtL6pUFg8MDvxV0CwwTbZtR7O6kIFJ-U0JJEJztalFA3Ls1kNsazw';
					authConfig.domain = "Springfield Public Schools";   
				}
				if(requestBody.channel==14){
					console.log(234)
					authConfig.client_id = '269597692574-63k2p1f78d1ihlm2o3pmg92smtqp6k5o.apps.googleusercontent.com';
					authConfig.client_secret = 'OLoRMZUonR2q3iXj6SxUB7wG';
					authConfig.refresh_token = '1//043yg9izKSr25CgYIARAAGAQSNwF-L9IrrGSrsoORPRhfMA27ebisg3KwULyr-mFKgmnmVENxAi8fz4lYjUm3wCWwhOe5pYqSppo';
					authConfig.domain = "Hazel Park School District";   
				}
				if(requestBody.channel==15){
					console.log(234)
					authConfig.client_id = '31535338808-b8mhfejhfc7j1ssvp32shfu9u0sqk1kf.apps.googleusercontent.com';
					authConfig.client_secret = 'QwNf1PCdBHibPx8DiCPHbOaY';
					authConfig.refresh_token = '1//04NlRNCzTa21SCgYIARAAGAQSNwF-L9IrH2NKTl8MqI4kUhpEAKnfCjze6eMXMRH1EZJQaZfPB8EqV2ZS0U9W2QjkFo-3-SuId2o';
					authConfig.domain = "Beaumont Independent School District";   
				}
				if(requestBody.channel==16){
					console.log(234)
					authConfig.client_id = '815870843103-mkd6o25boag5d2ugjq8pf3t5sdp63dl4.apps.googleusercontent.com';
					authConfig.client_secret = 'RJrBIXI8_ijr4ZbzrHlHi3fA';
					authConfig.refresh_token = '1//04xCnm8g5FbQqCgYIARAAGAQSNwF-L9Ir0YPA6NIJbegmZlsPERnIfFbrqhOkhZ8XVehrNA6cFQVob7oYlumylUyE16EtJ9Zo-tE';
					authConfig.domain = "Southgate Community School District";   
				}
				if(requestBody.channel==17){
					console.log(234)
					authConfig.client_id = '1014368837433-b8q3169k9284c2uq1nha43n98nckoej4.apps.googleusercontent.com';
					authConfig.client_secret = 'tVWhcZanAafLsusTikO7Z7vs';
					authConfig.refresh_token = '1//040hsUrsV3cedCgYIARAAGAQSNwF-L9Irxbw4b9Fg-5rX3Zz4mSzl_t3t0K5Tj9Yl7p9vDGhbOSOtGdhdmleSzc5fUA_NUXNe6cU';
					authConfig.domain = "Choix 17";   
				}
				if(requestBody.channel==18){
					console.log(234)
					authConfig.client_id = '437539919025-ugmufsc8h4h9949f97rt3tjacir1qhi9.apps.googleusercontent.com';
					authConfig.client_secret = 'VRuMTXE7H9Ztu18Lvhq1Lttb';
					authConfig.refresh_token = '1//04gszgRhtl835CgYIARAAGAQSNwF-L9IrR0MGYG5umI39ticJFJQ5WTLMvvs65jZcu2ds-kcindM1SXFLccpp2DcfZsveh-lTXx4';
					authConfig.domain = "SAIS Dubai";   
				}
				if(requestBody.channel==19){
					console.log(234)
					authConfig.client_id = '186218399082-q1n7p5rodf4oq3grrsebo8ua01oo7fuo.apps.googleusercontent.com';
					authConfig.client_secret = '0rfuiXBUa4M9qYni_sLWw4G3';
					authConfig.refresh_token = '1//04stV2rULCQiACgYIARAAGAQSNwF-L9Irs8goYN20T_sYulE2UHC7soFBTj_b_TJOC5O1zO9jQi1DzZybRITFZIhDO0KPs1sDnZI';
					authConfig.domain = "Dighton-Rehoboth Regional School District";   
				}
				if(requestBody.channel==20){
					console.log(234)
					authConfig.client_id = '297830979095-ifl9a1vmdi865knuorj2pk68otc2h6bt.apps.googleusercontent.com';
					authConfig.client_secret = 'BeIL0ocrTAMsOAM1Z9vZlE3W';
					authConfig.refresh_token = '1//04StF4a8VvMr8CgYIARAAGAQSNwF-L9IrPQkla3Z9shMvc9f5Fk3CnfhAIIjhTw388i1ufrXcD55Er-Y4eM-dGYPDXi7-9El7LLg';
					authConfig.domain = "High Tech High";   
				}
				if(requestBody.channel==21){
					console.log(234)
					authConfig.client_id = '1018512152826-vonotirj29e41nr9efe0a4c01tho2gb8.apps.googleusercontent.com';
					authConfig.client_secret = 'oqR2J5t4d7melzor_GGTVWf6';
					authConfig.refresh_token = '1//04WWqCiBxxRZCCgYIARAAGAQSNwF-L9Irgfqv2LpGLSycsjXw-vzzmzZx7iUewi0ViqQi2635sEgHRgIKzk3lDm66HXs5k9hHbpg';
					authConfig.domain = "Livonia Public Schools";   
				}
				if(requestBody.channel==22){
					console.log(234)
					authConfig.client_id = '476592273025-b3v6d3kin1558pk0c9fmpinjo7t5kq1d.apps.googleusercontent.com';
					authConfig.client_secret = 'l-WB9W--5GLjM_Vi1TftXVTm';
					authConfig.refresh_token = '1//04o4wumGH2emXCgYIARAAGAQSNwF-L9IrirRrDu7C2GxO9E4D9D1j4q6ra93qM5uenQrjuJHrOcrE30CeQdfMqVQt1BjTceLxsVM';
					authConfig.domain = "Dighton-Rehoboth Regional School District";   
				}
				if(requestBody.channel==23){
					console.log(234)
					authConfig.client_id = '926046206168-6qusv3mc16ohie185ec92b81euip5q3c.apps.googleusercontent.com';
					authConfig.client_secret = 'rWfCHmxd33drYLZvfw1JszLw';
					authConfig.refresh_token = '1//04K8esTGwOyCICgYIARAAGAQSNwF-L9Ire2vxMBI68seGSX3_QUy9gZrqN3S3_yVIsGhHmGJ7wZwbXnoCvfZ0nIo0GktJmEdYuh4';
					authConfig.domain = "Maui High School";   
				}
				if(requestBody.channel==24){
					console.log(234)
					authConfig.client_id = '993837707072-64rhioidhoa9rla3v5u8kup7nsukunpp.apps.googleusercontent.com';
					authConfig.client_secret = 'ZWdibbgmw0I-vRRVannTcqOB';
					authConfig.refresh_token = '1//04otZ0JalI4lKCgYIARAAGAQSNwF-L9IrAebMTsvrnuvD4rR6MBnlbIAJDosm6n3_EUd1Y_NGEvidLzdbWJzlg5wNDIxpaGNc19c';
					authConfig.domain = "Montgomery Bell Academy";   
				}
				if(requestBody.channel==25){
					console.log(234)
					authConfig.client_id = '821111846605-mb1jbrufdo13jen7jll7pbcda8936n6a.apps.googleusercontent.com';
					authConfig.client_secret = '2mz3hdvP2AYM2K55MjZ_OIRz';
					authConfig.refresh_token = '1//04NcQj6EZ8hk9CgYIARAAGAQSNwF-L9IrtG7QksuKXTJdRTU1P6ZuxWhjq0B8ab1s09j6ir660klndXSX7KF8gVEZXUpmF4WcnmQ';
					authConfig.domain = "Hemet Unified School District";   
				}
				if(requestBody.channel==26){
					console.log(234)
					authConfig.client_id = '917416955224-ae9mltoi8fkm5p1ns7dg0se38qs542ga.apps.googleusercontent.com';
					authConfig.client_secret = 'gdKcam0pRk0wcSDbREUv-646';
					authConfig.refresh_token = '1//04TnHhYMHZJEMCgYIARAAGAQSNwF-L9IrrCVChq43dJMjzjLEmCAiD2jOTiqEtPCXE_6r7JaKu6BjItZCX86x7fu1BoNnbb8OPkI';
					authConfig.domain = "Gehlen Catholic School";   
				}
				if(requestBody.channel==27){
					console.log(234)
					authConfig.client_id = '874958572345-bt4k5efig0meb2setfd44jen2rhs6e2o.apps.googleusercontent.com';
					authConfig.client_secret = '1gFfM84QF4NIWkjNbbVu4mL2';
					authConfig.refresh_token = '1//04ERhPQeL1YLsCgYIARAAGAQSNwF-L9IrSl7n4XUqIxLOaFu0ozo47AC2ovMbNdi95UW9DS5uIE3fKwHUZGX7x4LWX1coU793pEY';
					authConfig.domain = "Russell County Public Schools";   
				}
				if(requestBody.channel==28){
					console.log(234)
					authConfig.client_id = '271477897888-hn4q1rsbtlmun781694amod1ugpc4bv7.apps.googleusercontent.com';
					authConfig.client_secret = 'QcvprZVfrvvxfdPDZbycgWmV';
					authConfig.refresh_token = '1//04RhfXREstGrKCgYIARAAGAQSNwF-L9IrQVc3eQtc7Ac6gOPLn3hCpKvhMIjSjqDtQsgmTI8F3gzb88kefF4KUVLiLU0LAAijtpQ';
					authConfig.domain = "SMASH";   
				}
				if(requestBody.channel==29){
					console.log(234)
					authConfig.client_id = '67576353262-2tliojphkcltjvboqlegm456g8rngmt9.apps.googleusercontent.com';
					authConfig.client_secret = 'fUis662foXWr6VpI97CKHw6V';
					authConfig.refresh_token = '1//04CkeMNFWLUqfCgYIARAAGAQSNwF-L9IrGR6hll0XOUaN0dacZPGYa6Ip4-6JRwwlFEvn_XSKMLgLd2LwedIgvrUMnLPhb7py7qk';
					authConfig.domain = "Maumee City Schools";   
				}
				if(requestBody.channel==30){
					console.log(234)
					authConfig.client_id = '583074066432-j5lqehs8q0eb8huee011nkit625isbs1.apps.googleusercontent.com';
					authConfig.client_secret = '6j7fdV8Mr352GiwFEvjfTWIM';
					authConfig.refresh_token = '1//04ttKGrnYFdVsCgYIARAAGAQSNwF-L9IrEeBdSXiq7p2xWq_RWY6e4_gSeHeoJlNt-mc_a_eUb0fVTZNiPBXrl0w9P98LxiFXKFc';
					authConfig.domain = "George L Egbert Intermediate School";   
				}
				if(requestBody.channel==31){
					console.log(234)
					authConfig.client_id = '577183964799-n8unfahif4dgp2tig1plpqi6b4pd0rl4.apps.googleusercontent.com';
					authConfig.client_secret = 'PIRIgYH5UzgX7KYjzTtPIKTW';
					authConfig.refresh_token = '1//04HKW5GJBoUOSCgYIARAAGAQSNwF-L9Irec6NfccVUwWVLHtk7KsojxMNEaVLXqJbZQ1AGKYzxzmfGP2lYo9jIDn5LoHFil3WTOk';
					authConfig.domain = "Zane Trace Local School District";   
				}
				if(requestBody.channel==32){
					console.log(234)
					authConfig.client_id = '281873994029-ug1o05fojf79llso31l3be70qggqcpd0.apps.googleusercontent.com';
					authConfig.client_secret = 'zrlynD-d7zsdWmJ1Vi7oAwS6';
					authConfig.refresh_token = '1//04HC3ooLTQ-rkCgYIARAAGAQSNwF-L9IrTffmYZ6pAZboNAOLJe_SMvuiloR2hbfLj1pkIaJpD5GQV44kvJwz5nD196ThJwwoRgQ';
					authConfig.domain = "IPAE";   
				}
				if(requestBody.channel==33){
					console.log(234)
					authConfig.client_id = '902775283857-urk03r7am01nnsac6if6dbghtli2mdir.apps.googleusercontent.com';
					authConfig.client_secret = 'AE6pEXMq0Te6Jo_YhURJpeR8';
					authConfig.refresh_token = '1//04YQWiR_XXWPVCgYIARAAGAQSNwF-L9IrfHCHuRV_gtQBrMybZ9YutrPtRxZVkF2RDfHeaTMfZOEephJGZD-HOwxFcFZ2tfedJs8';
					authConfig.domain = "Pennsauken Public Schools";   
				}
				if(requestBody.channel==34){
					console.log(234)
					authConfig.client_id = '176597803347-t0r8o7dri73ujfrol0b5icbm7tv47jeq.apps.googleusercontent.com';
					authConfig.client_secret = 'Ok5WEjX6wqoxpZ_puSzwuLFT';
					authConfig.refresh_token = '1//040zM5HToMAbUCgYIARAAGAQSNwF-L9Irc1uykw3Wi-MF6e-sdV5m4SzNJVJAGlf8sFySMrLFA2KUg0B3Cn3nMn8BttOpSTFI6RY';
					authConfig.domain = "North Crawford School District";   
				}
				if(requestBody.channel==35){
					console.log(234)
					authConfig.client_id = '593471546084-va7sno7kir7pj6jine96ps8iacgm1vaq.apps.googleusercontent.com';
					authConfig.client_secret = 'qVdzG7ChlK4BWrRTfCnnft98';
					authConfig.refresh_token = '1//045hlR9Z2GANQCgYIARAAGAQSNwF-L9IrnXlCSZpnFg0dF14UMrbzGheSwB9YFath0DQca69MAOa-g-yXkOpTb_pssGkjSEsiNLQ';
					authConfig.domain = "Garland ISD";   
				}
				if(requestBody.channel==36){
					console.log(234)
					authConfig.client_id = '806913732224-i2slt7ejibfonqemu9n64pg0lbqlvb4b.apps.googleusercontent.com';
					authConfig.client_secret = 'qHuMDM_UDgH_Lwk_FLBy5hpn';
					authConfig.refresh_token = '1//04h3qusBQJHRpCgYIARAAGAQSNwF-L9IrLtYJZp2rf1hUZeUHDjkIqT6H2lBy3xdsCj6nvnFRZOU8uMskuOEbBImupd7NxTU3Mjo';
					authConfig.domain = "Central Square School District";   
				}
				if(requestBody.channel==37){
					console.log(234)
					authConfig.client_id = '126076575402-k1p563phadj549bj8vr2dm70b6bvrqlb.apps.googleusercontent.com';
					authConfig.client_secret = 'hIv1cTCZNB55F_v0DgovH1ca';
					authConfig.refresh_token = '1//04tt7OhJBbBFMCgYIARAAGAQSNwF-L9IrzYu9196LJF_7njoHhm1hOgD_Ckuxtb95OHMUwTdhnaodRq1sFFRuyvCcrIAPp64xmw8';
					authConfig.domain = "Walpole Public Schools";   
				}
				if(requestBody.channel==38){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0d5Wb8BYLdnuQCgYIARAAGA0SNwF-L9IrRD9AZYud9SKK9_FpHelD4XFZdIs9sVjFgXCgyz2PQlLpAgNHHS4iOCvHzhSWafLsJdk';
					authConfig.domain = "Walpole Public Schools";   
				}
				if(requestBody.channel==39){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0d9-hV8J368msCgYIARAAGA0SNwF-L9IrN9-B7Wd6JNd8OGZgqGADxKr8AWrZ6lzXCBCWHfKKNReK3Cc2QHUfuI85kGyUSKA4LBA';
					authConfig.domain = "COLEGIO SAN AGUSTIN";   
				}
				if(requestBody.channel==40){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0gVUpx72S6DR8CgYIARAAGBASNwF-L9IrvIEIPbz5nHNXIlqxSMT2ZkXZsyXjlKpdAjXLIv__ZSto3ohloeB0VSPYfuBpkQ3NWkw';
					authConfig.domain = "Don Bosco Educational Centers";   
				}
				if(requestBody.channel==41){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0dvX4MSFYakTGCgYIARAAGA0SNwF-L9Ir_TyqErY90lOf2CE7aoBk-ZBDojF91pA5c-EQSD_AvpELQLvJ7K2WPdDoSGnNkJ5FAws';
					authConfig.domain = "Dinas Pendidikan DKI Jakarta Indonesia";   
				}
				if(requestBody.channel==42){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0d8KTtsSggR2QCgYIARAAGA0SNwF-L9IrlULmG3l1oYE-JSCto-F2b69Qb4du9xpCpBKcph5X1MxwfexSU8sQLPM_tTJIraGewok';
					authConfig.domain = "Department of Education";   
				}
				if(requestBody.channel==43){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0dlmkioC9To5VCgYIARAAGA0SNwF-L9IrXHP68E-9OECZE0zmOg0bLB1TeGdXZztRgMNapeuKNYRguBhtrWdvvCS-jtt_EoX4r8Y';
					authConfig.domain = "KVS Delhi Region";   
				}
				if(requestBody.channel==44){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0dJ2cQUUYjKcjCgYIARAAGA0SNwF-L9IrMtdFwFuALHhyDFEaRdFhtL1Pwvlw4S_D0f2Z3T4jlHo1ThL8hLHsAmz-tyWljqpHGo4';
					authConfig.domain = "Suryadatta Group Of Institute";   
				}
				if(requestBody.channel==45){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0d1Eg1lNmdBTyCgYIARAAGA0SNwF-L9IrX7Ph2SBOcVB-1UDhMA9WOP5VLfACZTKL9pvg9QaSgAf9L7QDiARP6u_pHUd0OSjeGTQ';
					authConfig.domain = "DepEd Dasmari√±as";   
				}
				if(requestBody.channel==46){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0dVj2TmSqtFdGCgYIARAAGA0SNwF-L9IrEY3SPxFQ12EVV1gCIbc2pTJ5lf5EvNydbuNOCJ3-r5RpfZ-Hda2nzMdqH62NeoIVKZg';
					authConfig.domain = "Liceul Waldorf Cluj";   
				}
				if(requestBody.channel==47){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0d6aWkj8bzVI-CgYIARAAGA0SNwF-L9Irn0YaWek91d6my6DEzUH4XGXYhCWuU0Fw1Migv0OCq-7JDChnKoAytVx0_5UByuMS7bg';
					authConfig.domain = "Schools Division Office of Quezon City";   
				}
				if(requestBody.channel==48){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0dGhoxglCp5msCgYIARAAGA0SNwF-L9IruVe8hG0kbVc17DCIUYUyhXsrvnOfPAxLX9zeLFTEherWxhX5nPJxIzn5_CeswgjX5Sk';
					authConfig.domain = "Gmail";   
				}
				if(requestBody.channel==49){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0d4h0LKxOTFpgCgYIARAAGA0SNwF-L9IrrfTGm_4I2nfep_0l4K8wy-fc0K4oAhrCKsq6MrmizurCUxb7v1x60-aHgrVreVvaK48';
					authConfig.domain = "ŸÖÿØÿßÿ±ÿ≥ ÿßŸÑÿßÿ™ÿ≠ÿßÿØ ÿßŸÑÿ≠ÿ±ÿ©";   
				}
				if(requestBody.channel==50){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0dZyuOOFXeyBgCgYIARAAGA0SNwF-L9IryrMeigkF-eMrCRYRbumy_yztpC1k7BxfFd8dMadnTXmIuZi_hjwrBZ3ZZXJQl1XsmLA';
					authConfig.domain = "Three H Redwood Academy";   
				}
				if(requestBody.channel==51){
					console.log(234)
					authConfig.client_id = '58094879805-4654k2k5nqdid5bavft7fvea5u9po0t1.apps.googleusercontent.com';
					authConfig.client_secret = 'ZNPZ-vS6N9Zjsyb_sNMZmXHL';
					authConfig.refresh_token = '1//0dr3C4yO4R5zzCgYIARAAGA0SNwF-L9Ir1szIhEY345MetO7yMDyLT5vmU9gb9oXzrI-_DTAyS3IwjlwxhSo95xxCzygNawgX554';
					authConfig.domain = "MICA";   
				}
				if (authConfig.dailyLimit) {
					if (dailyLimit.includes(requestBody.emailAddress)) {
						return new Response("‚ùå You have reached the maximum number of creations allowed today!", {
							status: 429
						});
					} else {
						dailyLimit.push(requestBody.emailAddress);
					}
				}

				if (authConfig.black_list.includes(requestBody.emailAddress)) {
					return new Response("‚ùî Please fill in all the fields ", {
						status: 429
					});
				}

				try {
					let result = await gd.createAndShareTeamDrive(requestBody);
					return new Response("‚úÖ Your Shared Drive has successfully been created !", {
						status: 200
					});
				} catch (err) {
					return new Response(err.toString(), {
						status: 500
					});
				}
			} else if (request.method === "OPTIONS") {
				return new Response("", {
					status: 200,
					headers: {
						"Access-Control-Allow-Origin": "*"
					}
				});
			} else {
				return new Response("Bad Request", {
					status: 400
				});
			}
		default:
			return new Response(html, {
				status: 200,
				headers: {
					"Content-Type": "text/html; charset=utf-8",
					"Access-Control-Allow-Origin": "*"
				}
			});
	}
}
// https://stackoverflow.com/a/2117523
function uuidv4() {
	return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, c => {
		// tslint:disable-next-line:one-variable-per-declaration
		const r = (Math.random() * 16) | 0,
			// tslint:disable-next-line:triple-equals
			v = c == "x" ? r : (r & 0x3) | 0x8;
		return v.toString(16);
	});
}

class googleDrive {

	constructor(authConfig) {
		this.authConfig = authConfig;
		this.accessToken();
	}

	async getTeamDriveThemes() {
		let url = "https://www.googleapis.com/drive/v3/about";
		let requestOption = await this.requestOption();
		let params = { fields: "teamDriveThemes" };
		url += "?" + this.enQuery(params);
		let response = await fetch(url, requestOption);
		return await response.json();
	}

	async createAndShareTeamDrive(requestBody) {
		// Create team drive
		console.log("Creating TeamDrive");
		let url = "https://www.googleapis.com/drive/v3/drives";
		let requestOption = await this.requestOption(
			{ "Content-Type": "application/json" },
			"POST"
		);
		let params = { requestId: uuidv4() };
		url += "?" + this.enQuery(params);
		let post_data = {
			name: requestBody.teamDriveName
		};
		if (
			requestBody.teamDriveThemeId &&
			requestBody.teamDriveThemeId !== "random"
		) {
			post_data.themeId = requestBody.teamDriveThemeId;
		}
		requestOption.body = JSON.stringify(post_data);
		let response = await fetch(url, requestOption);
		let result = await response.json();
		const teamDriveId = result.id;
		console.log("Created TeamDrive ID", teamDriveId);

		// Get created drive user permission ID
		console.log(`Getting creator permission ID`);
		url = `https://www.googleapis.com/drive/v3/files/${teamDriveId}/permissions`;
		params = { supportsAllDrives: true };
		params.fields = "permissions(id,emailAddress)";
		url += "?" + this.enQuery(params);
		requestOption = await this.requestOption();
		response = await fetch(url, requestOption);
		result = await response.json();
		const currentUserPermissionID = result.permissions[0].id;
		console.log(currentUserPermissionID);

		// Share team drive with email address
		console.log(`Sharing the team drive to ${requestBody.emailAddress}`);
		url = `https://www.googleapis.com/drive/v3/files/${teamDriveId}/permissions`;
		params = { supportsAllDrives: true };
		url += "?" + this.enQuery(params);
		requestOption = await this.requestOption(
			{ "Content-Type": "application/json" },
			"POST"
		);
		post_data = {
			role: "organizer",
			type: "user",
			emailAddress: requestBody.emailAddress
		};
		requestOption.body = JSON.stringify(post_data);
		response = await fetch(url, requestOption);
		await response.json();

		// Delete creator from the team drive
		console.log("Deleting creator from the team drive");
		url = `https://www.googleapis.com/drive/v3/files/${teamDriveId}/permissions/${currentUserPermissionID}`;
		params = { supportsAllDrives: true };
		url += "?" + this.enQuery(params);
		requestOption = await this.requestOption({}, "DELETE");
		response = await fetch(url, requestOption);
		return await response.text();
	}

	async accessToken() {
		console.log("accessToken");
		if (
			this.authConfig.expires == undefined ||
			this.authConfig.expires < Date.now()
		) {
			const obj = await this.fetchAccessToken();
			if (obj.access_token != undefined) {
				this.authConfig.accessToken = obj.access_token;
				this.authConfig.expires = Date.now() + 3500 * 1000;
			}
		}
		return this.authConfig.accessToken;
	}

	async fetchAccessToken() {
		console.log("fetchAccessToken");
		const url = "https://www.googleapis.com/oauth2/v4/token";
		const headers = {
			"Content-Type": "application/x-www-form-urlencoded"
		};
		const post_data = {
			client_id: this.authConfig.client_id,
			client_secret: this.authConfig.client_secret,
			refresh_token: this.authConfig.refresh_token,
			grant_type: "refresh_token"
		};

		let requestOption = {
			method: "POST",
			headers: headers,
			body: this.enQuery(post_data)
		};

		const response = await fetch(url, requestOption);
		return await response.json();
	}

	async requestOption(headers = {}, method = "GET") {
		const accessToken = await this.accessToken();
		headers["authorization"] = "Bearer " + accessToken;
		return { method: method, headers: headers };
	}

	enQuery(data) {
		const ret = [];
		for (let d in data) {
			ret.push(encodeURIComponent(d) + "=" + encodeURIComponent(data[d]));
		}
		return ret.join("&");
	}
}